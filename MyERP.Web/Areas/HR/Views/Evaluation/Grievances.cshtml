@{
    ViewData["Title"] = "سجل التظلمات والشكاوى الإدارية";
}

<!-- CSS Plugins -->
<link rel="stylesheet" href="~/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" href="~/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
<link rel="stylesheet" href="~/plugins/select2/css/select2.min.css">
<link rel="stylesheet" href="~/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">
<link rel="stylesheet" href="~/plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css">

<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0 text-dark"><i class="fas fa-gavel text-secondary me-2"></i> التظلمات الإدارية</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                    <li class="breadcrumb-item"><a href="#">HR</a></li>
                    <li class="breadcrumb-item active">التظلمات</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<section class="content">
    <div class="container-fluid">

        <!-- 1. إحصائيات سريعة -->
        <div class="row">
            <div class="col-md-3 col-sm-6">
                <div class="info-box bg-gradient-info">
                    <span class="info-box-icon"><i class="far fa-copy"></i></span>
                    <div class="info-box-content">
                        <span class="info-box-text">إجمالي التظلمات</span>
                        <span class="info-box-number">45</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="info-box bg-gradient-warning">
                    <span class="info-box-icon"><i class="fas fa-hourglass-half"></i></span>
                    <div class="info-box-content">
                        <span class="info-box-text">قيد البحث (لجنة)</span>
                        <span class="info-box-number">5</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="info-box bg-gradient-success">
                    <span class="info-box-icon"><i class="fas fa-check"></i></span>
                    <div class="info-box-content">
                        <span class="info-box-text">تم قبول التظلم</span>
                        <span class="info-box-number">12</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="info-box bg-gradient-danger">
                    <span class="info-box-icon"><i class="fas fa-times"></i></span>
                    <div class="info-box-content">
                        <span class="info-box-text">مرفوض شكلاً/موضوعاً</span>
                        <span class="info-box-number">28</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. جدول التظلمات -->
        <div class="card card-outline card-secondary">
            <div class="card-header border-0">
                <h3 class="card-title text-bold">سجل الشكاوى والتظلمات المقدمة</h3>
                <div class="card-tools">
                    <button class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#grievanceModal">
                        <i class="fas fa-plus-circle me-1"></i> تسجيل تظلم جديد
                    </button>
                </div>
            </div>

            <div class="card-body">
                <table id="grievanceTable" class="table table-bordered table-striped text-center align-middle">
                    <thead class="bg-dark text-white">
                        <tr>
                            <th>م</th>
                            <th>تاريخ التقديم</th>
                            <th>الموظف</th>
                            <th>يتظلم من (القرار)</th>
                            <th>تاريخ القرار</th>
                            <th>مرفقات</th>
                            <th>قرار اللجنة</th>
                            <th>إجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- مثال 1: قيد البحث -->
                        <tr>
                            <td>1</td>
                            <td>15/07/2024</td>
                            <td class="text-end fw-bold">محمد فؤاد ابراهيم</td>
                            <td>
                                <span class="badge bg-warning text-dark">تقرير الكفاءة</span>
                                <br><small>تقدير "كفء" بدلاً من "ممتاز"</small>
                            </td>
                            <td>01/07/2024</td>
                            <td><i class="fas fa-paperclip text-secondary"></i></td>
                            <td><span class="badge bg-warning text-dark p-2">جاري العرض على اللجنة</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#decisionModal"><i class="fas fa-gavel me-1"></i> البت في التظلم</button>
                            </td>
                        </tr>

                        <!-- مثال 2: تم القبول -->
                        <tr>
                            <td>2</td>
                            <td>10/06/2024</td>
                            <td class="text-end fw-bold">فاطمة الشرباني</td>
                            <td>
                                <span class="badge bg-danger">قرار جزاء (خصم)</span>
                                <br><small>خصم 3 أيام (القرار 102)</small>
                            </td>
                            <td>01/06/2024</td>
                            <td><i class="fas fa-file-pdf text-danger"></i></td>
                            <td>
                                <span class="badge bg-success p-2">تم القبول (إلغاء الجزاء)</span>
                                <div class="text-muted small mt-1">تاريخ البت: 20/06/2024</div>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-dark" onclick="printDecision()"><i class="fas fa-print"></i> قرار اللجنة</button>
                            </td>
                        </tr>

                        <!-- مثال 3: مرفوض -->
                        <tr>
                            <td>3</td>
                            <td>05/01/2024</td>
                            <td class="text-end fw-bold">بهجت إبراهيم</td>
                            <td>
                                <span class="badge bg-purple">نقل تعسفي</span>
                                <br><small>نقل لفرع مطوبس</small>
                            </td>
                            <td>01/01/2024</td>
                            <td>-</td>
                            <td><span class="badge bg-danger p-2">رفض التظلم (صحة القرار)</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-dark"><i class="fas fa-eye"></i> التفاصيل</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</section>

<!-- Modal 1: تسجيل تظلم (استلام الطلب من الموظف) -->
<div class="modal fade" id="grievanceModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-secondary text-white">
                <h5 class="modal-title"><i class="fas fa-file-alt me-2"></i> استلام طلب تظلم</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post">
                <div class="modal-body">
                    <div class="row">
                        <!-- البيانات الأساسية -->
                        <div class="col-md-6 mb-3">
                            <label class="form-label">الموظف المتظلم</label>
                            <select class="form-select select2 select2-modal" style="width:100%">
                                <option>بحث...</option>
                                <option>محمد فؤاد ابراهيم</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">نوع التظلم</label>
                            <select class="form-select" id="grievanceType">
                                <option>من تقرير تقويم الأداء</option>
                                <option>من قرار جزاء / تأديب</option>
                                <option>من قرار نقل / ندب</option>
                                <option>تخطي في الترقية</option>
                                <option>أخرى</option>
                            </select>
                        </div>

                        <!-- تفاصيل القرار المشكو في حقه -->
                        <div class="col-md-4 mb-3">
                            <label class="form-label">رقم القرار / التقرير</label>
                            <input type="text" class="form-control" placeholder="مثال: جزاء رقم 55">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">تاريخ صدور القرار</label>
                            <input type="date" class="form-control">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">تاريخ استلام التظلم (اليوم)</label>
                            <input type="date" class="form-control" value="@DateTime.Now.ToString("yyyy-MM-dd")">
                        </div>

                        <div class="col-md-12 mb-3">
                            <label class="form-label">أسباب التظلم (موجز الشكوى)</label>
                            <textarea class="form-control" rows="3" placeholder="أذكر الأسباب التي يستند عليها الموظف..."></textarea>
                        </div>

                        <div class="col-md-12 mb-3">
                            <label class="form-label">مرفقات (صورة التظلم موقعة / مستندات مؤيدة)</label>
                            <input type="file" class="form-control" multiple>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-bs-dismiss="modal">إلغاء</button>
                    <button type="submit" class="btn btn-secondary"><i class="fas fa-save me-1"></i> تسجيل وإحالة للجنة</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal 2: قرار اللجنة (البت في التظلم) -->
<div class="modal fade" id="decisionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title"><i class="fas fa-gavel me-2"></i> قرار لجنة التظلمات</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">منطوق قرار اللجنة:</label>
                        <select class="form-select form-control-lg" id="decisionStatus">
                            <option value="Rejected">رفض التظلم (تأييد القرار الأصلي)</option>
                            <option value="Accepted">قبول التظلم (سحب القرار)</option>
                            <option value="Modified">قبول جزئي (تعديل القرار)</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">حيثيات القرار / النتيجة النهائية</label>
                        <textarea class="form-control" rows="3" placeholder="مثال: تم التأكد من عدم ارتكاب المخالفة وقبول التظلم..."></textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">تاريخ البت</label>
                        <input type="date" class="form-control" value="@DateTime.Now.ToString("yyyy-MM-dd")">
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="submit" class="btn btn-success"><i class="fas fa-check-double me-1"></i> اعتماد وتغيير الحالة</button>
                </div>
            </form>
        </div>
    </div>
</div>


    <!-- JS Plugins -->
    <script src="~/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/plugins/select2/js/select2.full.min.js"></script>
    <script src="~/plugins/sweetalert2/sweetalert2.min.js"></script>

    <script>
        $(function () {
            // الجدول
            $("#grievanceTable").DataTable({
                "language": { "url": "//cdn.datatables.net/plug-ins/1.10.25/i18n/Arabic.json" },
                "autoWidth": false,
                "lengthChange": false
            });

            // السليكت 2 داخل المودال
            $('.select2-modal').select2({
                theme: 'bootstrap4',
                dropdownParent: $('#grievanceModal')
            });
        });

        // رسالة عند الطباعة
        function printDecision() {
            Swal.fire({
                icon: 'success',
                title: 'جاري الطباعة',
                text: 'يتم تجهيز خطاب قرار اللجنة للطباعة...',
                timer: 1500,
                showConfirmButton: false
            });
        }
    </script>
